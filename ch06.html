<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 6. React on the Server</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="chapter" title="Chapter 6. React on the Server"><div class="titlepage"><div><div><h1 class="title"><a id="ch06">Chapter 6. React on the Server</a></h1></div></div></div><p class="it"><a>En el capítulo anterior, nos dimos un vistazo a la refactorización de nuestros componentes. Vimos cómo hacer uso de mixins y extraer funcionalidades similares a utilizar sin problemas en los componentes. También hicimos un vistazo a las interacciones DOM, usando árbitros y relacionados con las acciones de DOM de un componente.</a></p>

<p class="p">In the previous chapter, we took a look at refactoring our components. We saw how to make use of mixins and extract similar functionalities to use seamlessly across components. We also took a look at DOM interactions, using refs, and related DOM actions from a component.</p><p class="it"><a>En este capítulo, vamos a explorar cómo React los funciones en el lado del servidor. React nos permite procesar y manejar los componentes en el servidor de HTML, que es útil por varias razones pre-render. También vamos a echar un vistazo a cómo afecta esto a la React ciclo de vida de los componentes.</a></p>

<p class="p">In this chapter, we will explore how React functions on the server side. React allows us to render and handle components on the server to pre-render HTML, which is useful for several reasons. We will also take a look at how this affects the React component life cycle.</p><p class="it"><a>En este capítulo, vamos a cubrir los siguientes puntos:</a></p>

<p class="p">In this chapter, we will cover the following points:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Server-side rendering</li><li class="listitem" style="list-style-type: disc">Render functions</li><li class="listitem" style="list-style-type: disc">Server-side component life cycle</li></ul></div><p class="it"><a>Al final del capítulo, podremos empezar a utilizar componentes React en el lado del servidor y entender sus interacciones e implicaciones con el lado del servidor.</a></p>

<p class="p">At the end of chapter, we will be able to start using React components on the server side and understand its interactions and implications with the server side.</p><div class="section" title="Getting React to render on server"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec57">Getting React to render on server</a></h1></div></div></div><p class="it"><a>"Hey Shawn!" Mike </a><a id="id149" class="indexterm">sorprendió Shawn, entrando en su lugar de trabajo con una taza de café.</a></p>

<p class="p">"Hey Shawn!" Mike <a class="indexterm">startled Shawn, entering their workplace with a cup of coffee.</a></p><p class="it"><a class="indexterm">"Buenos días, Mike," respondió Shawn.</a></p>

<p class="p">"Good morning, Mike," replied Shawn.</p><p class="it"><a class="indexterm">Sol brillaba sobre la tabla de Shawn y entraron en una conversación sobre un nuevo proyecto que estaban a punto de comenzar.</a></p>

<p class="p">Sun sparkled on Shawn's desk and they entered into a conversation about a new project that they were about to begin.</p><p class="it"><a class="indexterm">"Shawn, sólo llegó a conocer, de Carla, sobre un nuevo proyecto que tenemos que tomar. El cliente nos ha pedido para construir una sencilla página de búsqueda para nuestro proyecto Open Library".</a></p>

<p class="p">"Shawn, I just came to know, from Carla, about a new project that we need to take. The client has asked us to build a simple search page for our Open Library project."</p><p class="it"><a class="indexterm">Shawn y Mike tenían previamente construir una aplicación para mostrar los cambios recientes de <code class="literal">openlibrary.com</code> aPI. Estaban ahora van a construir una aplicación de búsqueda en la parte superior de la API de búsqueda de Abrir biblioteca.</a></p>

<p class="p">Shawn and Mike had previously build an application to display recent changes from <code class="literal">openlibrary.com</code> API. They were now going to build a search application on top of Open Library's Search API.</p><p class="it"><a class="indexterm">"Impresionante", Mike estaba entusiasmado con esto. Él ya era amante de trabajo sobre React.</a></p>

<p class="p">"Awesome," Mike was excited about this. He was already loving working on React.</p><p class="it"><a class="indexterm">"Shawn, para este proyecto, que será opciones sobre cómo utilizar React en el servidor de exploración."</a></p>

<p class="p">"Shawn, for this project, we will be exploring options on how to use React on the server."</p><p class="it"><a class="indexterm">Hasta ahora, hemos estado montando manualmente nuestros componentes después de carga de la página. Hasta que el componente se representa, la página no tiene ningún contenido HTML desde el componente.</a></p>

<p class="p">Until now, we have been manually mounting our components after page load. Until the component is rendered, the page doesn't have any HTML content from the component.</p><p class="it"><a class="indexterm">"Vamos a ver cómo vamos a hacer esto en el servidor de manera que HTML es generado previamente en la página en lugar de después de la página se ha cargado por completo."</a></p>

<p class="p">"Let's see how we will be doing this on the server so that HTML is pre-generated on the page instead of after the page has completely loaded."</p><p class="it"><a class="indexterm">"Entendido. ¿Cómo está la representación de los componentes del lado del servidor, aunque útil?"</a></p>

<p class="p">"Got it. How is rendering of components on server side useful though?"</p><p class="it"><a class="indexterm">"Es útil para un par de razones. Un ser que estamos generando contenido en el servidor. Esto es útil para fines de SEO y una mejor indexación en los buscadores."</a></p>

<p class="p">"It is useful for a couple of reasons. One being that we are generating content on the server. This is useful for SEO purpose and better indexing with search engines."</p><p class="it"><a class="indexterm">"A medida que el contenido se </a><a id="id150" class="indexterm">genera en el servidor, el primer render sería mostrar la página inmediatamente en lugar de esperar a que la carga de la página para terminar correctamente, después de lo cual el componente quedaría."</a></p>

<p class="p">"As the content is <a class="indexterm">generated on the server, the first render would display the page immediately instead of waiting for the page load to properly finish, after which the component would be rendered."</a></p><p class="it"><a class="indexterm">"Esto también nos ayuda a evitar un efecto de parpadeo en nuestras cargas de la página. Hay otras sutilezas que podemos aprovechar, vamos a explorar más adelante," explica Mike.</a></p>

<p class="p">"This also helps us to avoid a flicker effect on our page loads. There are other such niceties that we can harness, we'll explore them later," Mike explained.</p><p class="it"><a class="indexterm">"Cool. Vamos a empezar entonces."</a></p>

<p class="p">"Cool. Let's begin then."</p><p class="it"><a class="indexterm">"Muy bien! Para este proyecto, vamos a empezar con un arrancador webpack Proyecto para gestionar nuestro código. Para el elemento servidor, vamos a utilizar expreso JS. Nosotros no vamos a hacer nada compleja aquí, nos limitaremos a exponer una ruta desde expreso JS y presentará una <code class="literal">.ejs</code> vista que consiste en nuestro componente ".</a></p>

<p class="p">"Alright! For this project, let's begin with a starter Webpack Project to manage our code. For the server element, we will be using Express JS. We won't be doing anything complex here, we will simply expose a route from Express JS and render a <code class="literal">.ejs</code> view that consists of our component."</p><p class="it"><a class="indexterm">"Un ejemplo de un tal </a><a id="id151" class="indexterm">proyecto inicial se podes encontrar en la </a><a class="ulink" href="http://webpack.github.io/">http://webpack.github.io/</a> página web", informó Mike.</p>

<p class="p">"An example of such a <a class="indexterm">starter project can be found on the </a><a class="ulink" href="http://webpack.github.io/">http://webpack.github.io/</a> website," informed Mike.</p><p class="it">"Cool, creo que vamos a dividir el código en el lado del cliente / servidor, así?"</p>

<p class="p">"Cool, I think we will divide the code on client/server side as well?"</p><p class="it">"Sí. Vamos a poner bajo el <code class="literal">/app</code> directorio para consistir en nuestros componentes, <code class="literal">/client</code> para el código específico del cliente, y <code class="literal">/server</code> el código que se utilizará en el servidor en nuestro <code class="literal">/src</code> directorio", continuó Mike.</p>

<p class="p">"Yes. Let's put them under the <code class="literal">/app</code> directory to consist our components, <code class="literal">/client</code> for client-specific code, and <code class="literal">/server</code> for the code to be used on server in our <code class="literal">/src</code> directory," continued Mike.</p><p class="it">"A continuación, será la creación de la <code class="literal">server.js</code> archivo en <code class="literal">/app/server</code> el directorio."</p>

<p class="p">"Next, we will be setting up the <code class="literal">server.js</code> file in <code class="literal">/app/server</code> directory."</p><div class="informalexample"><pre class="programlisting">import path from 'path';
import Express from 'express';

var app = Express();
var server;

const PATH_STYLES = path.resolve(__dirname, '../client/styles');
const PATH_DIST = path.resolve(__dirname, '../../dist');

app.use('/styles', Express.static(PATH_STYLES));
app.use(Express.static(PATH_DIST));

app.get('/', (req, res) =&gt; {
  res.sendFile(path.resolve(__dirname, '../client/index.html'));
});

server = app.listen(process.env.PORT || 3000, () =&gt; {
  var port = server.address().port;

  console.log('Server is listening at %s', port);
});</pre></div><p class="it">"Esa es una configuración bastante estándar expreso App. Estamos concretando los estilos que se utilizarán, ruta estática activos, y así sucesivamente."</p>

<p class="p">"That's a pretty standard Express App setup. We are specifying the styles to be used, static assets path, and so on."</p><p class="it">"Para nuestra ruta, estamos sencilla exposición de la raíz <code class="literal">/</code> al hacer esto:"</p>

<p class="p">"For our route, we are simple exposing the root <code class="literal">/</code> by doing this:"</p><div class="informalexample"><pre class="programlisting">app.get('/', (req, res) =&gt; {
  res.sendFile(path.resolve(__dirname, '../client/index.html'));
});</pre></div><p class="it">"Estamos pidiendo Express para <a id="id152" class="indexterm">servir al <code class="literal">index.html</code> archivo de solicitud de raíz. En nuestro <code class="literal">index.js</code> archivo, que estaremos pasando al nodo para ejecutar la aplicación, nos limitaremos a exponer el módulo de servidor que simplemente escribimos".</a></p>

<p class="p">"We are asking Express to <a class="indexterm">serve the <code class="literal">index.html</code> file on request to root. In our <code class="literal">index.js</code> file, which we will be passing to node to run the application, we will simply expose the server module that we just wrote."</a></p><div class="informalexample"><pre class="programlisting"><a class="indexterm">require('babel/register');

module.exports = require('./server');</a></pre></div><p class="it"><a class="indexterm">"Mike, ¿por qué se requiere babel / registrarse aquí?"</a></p>

<p class="p">"Mike, why do we require babel/register here?"</p><p class="it"><a class="indexterm">"Ah, claro. En este sentido, </a><a id="id153" class="indexterm">requerimos Babel ( </a><a class="ulink" href="http://babeljs.io/">http://babeljs.io/</a> ) para convertir los archivos a formato compatible con el explorador. Estamos utilizando alguna bondad sintaxis JavaScript ES2015. Babel nos ayuda a añadir soporte para la última versión de JavaScript a través de transformadores de sintaxis. Esto nos permite utilizar la última sintaxis de JavaScript, que no está soportado por los navegadores en este momento ".</p>

<p class="p">"Oh right. Here, we <a class="indexterm">require Babel (</a><a class="ulink" href="http://babeljs.io/">http://babeljs.io/</a>) to convert our files to browser-compatible format. We are using some JavaScript ES2015 syntax goodness. Babel helps us to add support for the latest version of JavaScript through syntax transformers. This allows us to use the latest JavaScript syntax, which is not supported by browsers right now."</p><p class="it">"Con esta configuración, vamos a definir nuestro <code class="literal">index.html</code> como:"</p>

<p class="p">"With this setup, we will define our <code class="literal">index.html</code> as:"</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang="en"&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;Search&lt;/title&gt;

  &lt;link href="styles/main.css" rel="stylesheet" /&gt;

  &lt;link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"&gt;
  &lt;link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"&gt;
&lt;link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"&gt;

&lt;/head&gt;
&lt;body&gt;
  &lt;div id="app"&gt;&lt;/div&gt;
  &lt;script src="bundle.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p class="it">"No hay mucho que está pasando por aquí. Simplemente estamos definiendo una única div en la parte superior de los cuales estaremos haciendo que el componente React."</p>

<p class="p">"Nothing much is going on over here. We are simply defining a single div on top of which we will be rendering the React component."</p><p class="it">"Además, notamos que <a id="id154" class="indexterm">hemos incluido enlaces a los archivos para añadir Bootstrap y Font apoyo impresionante a nuestra aplicación."</a></p>

<p class="p">"Also, notice that we <a class="indexterm">have included links to the files to add Bootstrap and Font Awesome support to our app."</a></p><p class="it"><a class="indexterm">"A continuación, en el lado del cliente render manipulación, que estaríamos haciendo"</a></p>

<p class="p">"Next, on the client-side render handling, we would be doing"</p><div class="informalexample"><pre class="programlisting">// file: scr/client/scripts/client.js
import App from '../../app';

var attachElement = document.getElementById('app');
var state = {};
var app;

// Create new app and attach to element
app = new App({ state: state});

app.renderToDOM(attachElement);</pre></div><p class="it"><a class="indexterm">"Por último, vamos a ver cómo el <code class="literal">App</code> se utiliza la clase definida aquí antes de pasar a nuestro componente real."</a></p>

<p class="p">"Finally, let's see how the <code class="literal">App</code> class defined here is used before moving to our actual component."</p><div class="informalexample"><pre class="programlisting">import React from 'react/addons';
import AppRoot from './components/AppRoot';

class App {
  constructor(options) {
    this.state = options.state;
 }

  render(element) {
    var appRootElement = React.createElement(AppRoot, {
      state: this.state
    });

    // render to DOM
    if (element) {
      React.render(appRootElement, element);
      return;
    }

    // render to string
    return React.renderToString(appRootElement);
  }

  renderToDOM(element) {
    if (!element) {
      new Error('App.renderToDOM: element is required');
    }

    this.render(element);
  }

  renderToString() {
    return this.render();
  }
}

export default App;</pre></div><p class="it"><a class="indexterm">"Wow, eso es mucho para asimilar," Shawn exhalado.</a></p>

<p class="p">"Wow, that's a lot to sink in," exhaled Shawn.</p><p class="it"><a class="indexterm">"Ja Dale un poco de tiempo Lo que estamos haciendo aquí es simplemente el cuidado de nuestra lógica de representación Si se pasa un elemento de esta clase, los contenidos se prestan en él;.. De lo contrario, vamos a devolver la versión de cadena rendido Nótese cómo. están utilizando <code class="literal">React.renderToString</code> para lograr el mismo. vamos a </a><a id="id155" class="indexterm">completar esta primera y vamos a continuación, volver a ella cuando vamos a utilizar para representar los contenidos en la solicitud del servidor."</a></p>

<p class="p">"Hah! Give it some time. What we are doing here is simply taking care of our rendering logic. If we pass an element to this class, contents are rendered onto it; otherwise, we will return the rendered string version. Notice how we are using <code class="literal">React.renderToString</code> to achieve the same. Let's <a class="indexterm">complete this first and we will then revisit it when we will be using it to render the contents on the server request."</a></p><p class="it"><a class="indexterm">"En pocas palabras, sólo estamos pidiendo React a tomar en un estado de un componente, hacerla, y devolver el contenido que se representan a partir del <code class="literal">render()</code> método como una cadena".</a></p>

<p class="p">"In a nutshell, we are just asking React to take in a state for a component, render it, and return the contents that would be rendered from the <code class="literal">render()</code> method as a string."</p><p class="it"><a class="indexterm">"A continuación, vamos a empezar por definir nuestro componente contenedor raíz."</a></p>

<p class="p">"We will then start by defining our root container component."</p><div class="informalexample"><pre class="programlisting">require("jquery");
import React from 'react/addons';
import SearchPage from './SearchPage'

var AppRoot = React.createClass({
    propTypes: {
      state: React.PropTypes.object.isRequired
    },
    render()
    {
      return &lt;SearchPage/&gt;;
    }
  })
  ;

export default AppRoot;</pre></div><p class="it"><a class="indexterm">"Aquí, simplemente definimos un recipiente para contener nuestro componente principal y requerir todas nuestras dependencias. Vamos a empezar la construcción de nuestra búsqueda de componentes siguiente."</a></p>

<p class="p">"Here, we simply define a container to hold our main component and require all our dependencies. Let's start building our Search Component next."</p><p class="it"><a class="indexterm">"Impresionante. Creo que puedo tomar eso. Parece que esto va a ser sólo un componente simple?"</a></p>

<p class="p">"Awesome. I think I can take that up. Looks like this will just be a simple component?"</p><p class="it"><a class="indexterm">"Sí. Andá por delante", respondió Mike.</a></p>

<p class="p">"Yup. Go ahead," replied Mike.</p><p class="it"><a class="indexterm">"Ok, veo que estaríamos </a><a id="id156" class="indexterm">necesitando para obtener los datos del punto final abierto API Library".</a></p>

<p class="p">"Ok, I see that we would be <a class="indexterm">needing to fetch data from the Open Library API endpoint."</a></p><a class="indexterm">
</a><a class="ulink" href="https://openlibrary.org/search.json?page=1&amp;q=searchTerm">https://openlibrary.org/search.json?page=1&amp;q=searchTerm</a>
<p></p><p class="it">"Aquí la <code class="literal">q</code> consulta <a id="id157" class="indexterm">de parámetros será el término de búsqueda Un ejemplo de respuesta se parece a:".</a></p>

<p class="p">"Here the <code class="literal">q</code> query <a class="indexterm">parameter will be the search term. An example response looks like:"</a></p><div class="informalexample"><pre class="programlisting"><a class="indexterm">{
 "start": 0,
 "num_found": 6,
 "numFound": 6,
 "docs": [
  {
   "title_suggest": "Automatic search term variant generation for document retrieval",
   "edition_key": [
    ..
   ],
…
   ],
   "author_name": [
..
..}]
}</a></pre></div><p class="it"><a class="indexterm">"Derecha", añadió Mike.</a></p>

<p class="p">"Right," added Mike.</p><p class="it"><a class="indexterm">"Creo que voy a empezar por definir el estado inicial en base a los <code class="literal">start</code>, <code class="literal">num_found</code> y <code class="literal">docs</code> los campos", dijo Shawn</a></p>

<p class="p">"I think I will start by defining the initial status based on the <code class="literal">start</code>, <code class="literal">num_found</code>, and <code class="literal">docs</code> fields," said Shawn</p><p class="it"><a class="indexterm">"Bueno."</a></p>

<p class="p">"Okay."</p><div class="informalexample"><pre class="programlisting">  getInitialState(){
    return {docs: [], numFound: 0, num_found: 0, start: 0, searchCompleted: false, searching: false}
  }</pre></div><p class="it"><a class="indexterm">"También he añadido otros dos estados que mantendrá: <code class="literal">searchCompleted</code> saber si la operación de búsqueda actual ha completado o no, y <code class="literal">searching</code> saber que estamos buscando actualmente algo."</a></p>

  <p class="p">"I also added two other states that I will maintain: <code class="literal">searchCompleted</code> to know whether the current search operation has completed or not and <code class="literal">searching</code> to know that we are currently searching something."</p><p class="it"><a class="indexterm">"Cool. Veamos el método render siguiente," continuó Mike.</a></p>

  <p class="p">"Cool. Let's see the render method next," continued Mike.</p><p class="it"><a class="indexterm">"Permítanme comenzar </a><a id="id158" class="indexterm">añadiendo el cuadro de búsqueda en el método <code class="literal">render</code>."</a></p>

  <p class="p">"Let me start by <a class="indexterm">adding the search box in the <code class="literal">render</code> method."</a></p><div class="informalexample"><pre class="programlisting"><a class="indexterm">render() {
    let tabStyles = {paddingTop: '5%'};
    return (
        &lt;div className='container'&gt;
          &lt;div className="row" style={tabStyles}&gt;
            &lt;div className="col-lg-8 col-lg-offset-2"&gt;
              &lt;div className="input-group"&gt;
                &lt;input type="text" className="form-control" placeholder="Search for Projects..." ref='searchInput'/&gt;
            &lt;span className="input-group-btn"&gt;
              &lt;button className="btn btn-default" type="button" onClick={this.performSearch}&gt;Go!&lt;/button&gt;
            &lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
       &lt;/div&gt;
    );
  },</a></pre></div><p class="it"><a class="indexterm">"Ahora deberíamos tener una pantalla para el cuadro de búsqueda."</a></p>

  <p class="p">"We should now have a display for the search box."</p><div class="mediaobject"><img src="graphics/4730_06_01.jpg" alt="Getting React to render on server"/></div><p class="it"><a class="indexterm">"A continuación, vamos a añadir el <code class="literal">performSearch</code> método que inicia la búsqueda basada en el término de búsqueda introducido por el usuario."</a></p>

  <p class="p">"Next, we will add the <code class="literal">performSearch</code> method that initiates searching based on the search term entered by the user."</p><div class="informalexample"><pre class="programlisting">  performSearch(){
    let searchTerm = $(this.refs.searchInput.getDOMNode()).val();
    this.openLibrarySearch(searchTerm);
    this.setState({searchCompleted: false, searching: true});
  },</pre></div><p class="it"><a class="indexterm">"Aquí, estamos simplemente ir a buscar el término de búsqueda introducido por el usuario y de pasarlo al <code class="literal">openLibrarySearch</code> método, que realmente va a realizar la búsqueda. A continuación, actualizamos el estado que estamos llevando a cabo una búsqueda activa ahora."</a></p>

  <p class="p">"Here, we are simply fetching the search term entered by the user and passing it to the <code class="literal">openLibrarySearch</code> method, which will actually perform the search. Then, we update the state that we are actively performing a search now."</p><p class="it"><a class="indexterm">"Vamos a completar la </a><a id="id159" class="indexterm">funcionalidad de búsqueda ahora".</a></p>

  <p class="p">"Let's complete the <a class="indexterm">search functionality now."</a></p><div class="informalexample"><pre class="programlisting"><a class="indexterm"> openLibrarySearch(searchTerm){
    let openlibraryURI = `https://openlibrary.org/search.json?page=1&amp;q=${searchTerm}}`;
    fetch(openlibraryURI)
        .then(this.parseJSON)
        .then(this.updateState)
        .catch(function (ex) {
          console.log('Parsing failed', ex)
        })
  }</a></pre></div><p class="it"><a class="indexterm">"Ah, bueno Shawn, que se </a><a id="id160" class="indexterm">usa <code class="literal">fetch</code> en lugar de Ajax regular!"</a></p>

  <p class="p">"Ah, nice Shawn, you are <a class="indexterm">using <code class="literal">fetch</code> instead of regular Ajax!"</a></p><p class="it"><a class="indexterm">"Eh, sí. He estado usando </a><a class="ulink" href="https://github.com/github/fetch">https://github.com/github/fetch</a> como polyfill para la <code class="literal">window.fetch</code> especificación."</p>

  <p class="p">"Huh, yeah. I have been using <a class="ulink" href="https://github.com/github/fetch">https://github.com/github/fetch</a> as a polyfill for the <code class="literal">window.fetch</code> specification."</p><p class="it">"Agradable, ¿no es así? Es compatible con la API simple y limpia, como Ajax, y una API unificada ir a buscar."</p>

  <p class="p">"Nice, isn't it? It supports simple and clean API, such as Ajax, and a unified fetching API."</p><p class="it">Después de ir a buscar de algún recurso o solicitud de finalización, las devoluciones de llamada caen a través de este se definen por el <code class="literal">then</code> método. Tené en cuenta que también hemos utilizado ES2015 cadena literal para construir el URI ", añadió Shawn.</p>

  <p class="p">After fetching of some resource or request completion, the callbacks fall through this are defined by the <code class="literal">then</code> method. Notice that we have also used ES2015 string literal to build the URI," added Shawn.</p><p class="it">"Cool. Parece que estás obteniendo los recursos y luego pasarla a <code class="literal">parseJSON</code> analizar y devolver el resultado JSON desde el cuerpo de la respuesta. Entonces, estamos actualizando el estado encima de él?"</p>

  <p class="p">"Cool. Looks like you are fetching the resource, then passing it to <code class="literal">parseJSON</code> to parse and return the JSON result from the response body. Then, are we updating the state on top of it?"</p><p class="it">"Sí, permítanme definir los"</p>

  <p class="p">"Yes, let me define those"</p><div class="informalexample"><pre class="programlisting">  parseJSON(response) {
    return response.json();
  },

// response.json() is returning the JSON content from the response. 
  
updateState(json){
    this.setState({
      ...json,
      searchCompleted: true,
      searching: false
    });
  },</pre></div><p class="it">"Después de conseguí la respuesta final, estoy actualizando y establecer el estado de resultados que se devuelve, así como la actualización de nuestra <code class="literal">searchCompleted</code> y búsqueda de estados para indicar la búsqueda de empleo que se hace."</p>

  <p class="p">"After getting the final response, I am updating and setting the state to result that is returned as well as updating our <code class="literal">searchCompleted</code> and searching states to indicate the searching job is done."</p><p class="it">"Ah, bueno Shawn, veo que ha iniciado la adopción y uso de las nuevas características de JS Siguiente !, como el <code class="literal">spread</code> operador."</p>

  <p class="p">"Ah, nice Shawn, I see that you have started adopting and using new features from JS Next!, like the <code class="literal">spread</code> operator."</p><p class="it">"Jaja, sí. Me he enamorado con estos. Estoy usando esto para fusionar las propiedades del resultado JSON con las nuevas claves que desee agregar y construir un nuevo objeto. Esto también se podes hacer de forma similar usando <code class="literal">Object.assign</code> que previamente vio ".</p>

  <p class="p">"Haha, yeah. I've fallen in love with these. I am using this to merge the properties of the JSON result with the new keys that I want to add and build a new object. This would also be done similarly using <code class="literal">Object.assign</code> that we previously saw."</p><div class="informalexample"><pre class="programlisting">Object.assign({}, json, {searchCompleted: true, searching: false} )</pre></div><div class="informalexample"><pre class="programlisting">Object.assign ({}, JSON, {searchCompleted: verdad, la búsqueda: false})</pre></div><p class="it">"De esa manera, estamos construyendo un <a id="id161" class="indexterm">nuevo objeto en lugar de la mutación de uno anterior."</a></p>

  <p class="p">"That way, we are building a <a class="indexterm">new object instead of mutating a previous one."</a></p><p class="it"><a class="indexterm">"Nice Shawn," Mike era feliz sabiendo que Shawn estaba caída de las cosas nuevas.</a></p>

  <p class="p">"Nice Shawn," Mike was happy knowing that Shawn was getting hang of the new things.</p><p class="it"><a class="indexterm">"Por último, permítanme añadir la pantalla de carga de acción para mostrar un icono de la cargadora y la visualización de los resultados reales. El método render ahora se verá así."</a></p>

  <p class="p">"Finally, let me add the loading action display to show a loader icon and display of actual results. The render method will now look like this."</p><div class="informalexample"><pre class="programlisting">render() {
    let tabStyles = {paddingTop: '5%'};
    return (
        &lt;div className='container'&gt;
          &lt;div className="row" style={tabStyles}&gt;
            &lt;div className="col-lg-8 col-lg-offset-2"&gt;
              &lt;div className="input-group"&gt;
                &lt;input type="text" className="form-control" placeholder="Search for Projects..." ref='searchInput'/&gt;
            &lt;span className="input-group-btn"&gt;
              &lt;button className="btn btn-default" type="button" onClick={this.performSearch}&gt;Go!&lt;/button&gt;
            &lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          { (() =&gt; {
            if (this.state.searching) {
              return this.renderSearching();
            }
            return this.state.searchCompleted ? this.renderSearchElements() : &lt;div/&gt;
          })()}
        &lt;/div&gt;
    );
  },</pre></div><p class="it"><a class="indexterm">"Aquí, estamos comprobando el estado actual de la operación de búsqueda. En base a esto, estamos mostrando el cargador del contenido, resultados, o un elemento real div vacío".</a></p>

  <p class="p">"Here, we are checking the current state of the search operation. Based on this, we are displaying the loader of the actual contents, results, or empty div element."</p><p class="it"><a class="indexterm">"Permítanme definir la </a><a id="id162" class="indexterm">carga y la representación de los elementos."</a></p>

  <p class="p">"Let me define the <a class="indexterm">loading and rendering of the elements."</a></p><div class="informalexample"><pre class="programlisting"><a class="indexterm">renderSearching(){
    return &lt;div className="row"&gt;
      &lt;div className="col-lg-8 col-lg-offset-2"&gt;
        &lt;div className='text-center'&gt;&lt;i className="fa fa-spinner fa-pulse fa-5x"&gt;&lt;/i&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;;
  },</a></pre></div><p class="it"><a class="indexterm">"Esto va a definir la visualización de la ruleta para indicar la carga."</a></p>

  <p class="p">"This will define the display of the spinner to indicate loading."</p><div class="informalexample"><pre class="programlisting">renderSearchElements(){
    return (

        &lt;div className="row"&gt;
          &lt;div className="col-lg-8 col-lg-offset-2"&gt;
            &lt;span className='text-center'&gt;Total Results: {this.state.numFound}&lt;/span&gt;

            &lt;table className="table table-stripped"&gt;
              &lt;thead&gt;
              &lt;th&gt;Title&lt;/th&gt;
              &lt;th&gt;Title suggest&lt;/th&gt;
              &lt;th&gt;Author&lt;/th&gt;
              &lt;th&gt;Edition&lt;/th&gt;
              &lt;/thead&gt;
              &lt;tbody&gt;
              {this.renderDocs(this.state.docs)}
              &lt;/tbody&gt;
            &lt;/table&gt;

          &lt;/div&gt;
        &lt;/div&gt;

    );
  },

  renderDocs(docs){
    return docs.map((doc) =&gt; {
      console.log(doc);
      return &lt;tr key={doc.cover_edition_key}&gt;
        &lt;td&gt;{doc.title}&lt;/td&gt;
        &lt;td&gt;{doc.title_suggest}&lt;/td&gt;
        &lt;td&gt;{(doc.author_name || []).join(', ')}&lt;/td&gt;
        &lt;td&gt;{doc.edition_count}&lt;/td&gt;
      &lt;/tr&gt;
    })
  },</pre></div><p class="it"><a class="indexterm">"Después de la adición de esto, la </a><a id="id163" class="indexterm">operación de búsqueda debería mostrar un cargador como tal."</a></p>

  <p class="p">"After adding this, the <a class="indexterm">searching operation should display a loader like so."</a></p><div class="mediaobject"><a class="indexterm"><img src="graphics/4730_06_02.jpg" alt="Getting React to render on server"/></a></div><p class="it"><a class="indexterm">Los resultados mostrados </a><a id="id164" class="indexterm">se vería así:</a></p>

  <p class="p">The results displayed <a class="indexterm">would look like this:</a></p><div class="mediaobject"><a class="indexterm"><img src="graphics/4730_06_03.jpg" alt="Getting React to render on server"/></a></div><p class="it"><a class="indexterm">"La completado </a><a id="id165" class="indexterm">componente es como sigue:"</a><a class="indexterm"> <code class="literal">SearchPage</code></a></p>

  <p class="p">"The completed <a class="indexterm">
<code class="literal">SearchPage</code> component is as follows:"</a></p><div class="informalexample"><pre class="programlisting"><a class="indexterm">import React from 'react';
var SearchPage = React.createClass({
  getInitialState(){
    return {docs: [], numFound: 0, num_found: 0, start: 0, searchCompleted: false, searching: false}
  },
  render() {
    let tabStyles = {paddingTop: '5%'};
    return (
      &lt;div className='container'&gt;
        &lt;div className="row" style={tabStyles}&gt;
          &lt;div className="col-lg-8 col-lg-offset-2"&gt;
            &lt;div className="input-group"&gt;
              &lt;input type="text" className="form-control" placeholder="Search for Projects..." ref='searchInput'/&gt;
            &lt;span className="input-group-btn"&gt;
              &lt;button className="btn btn-default" type="button" onClick={this.performSearch}&gt;Go!&lt;/button&gt;
            &lt;/span&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        { (() =&gt; {
          if (this.state.searching) {
            return this.renderSearching();
          }
          return this.state.searchCompleted ? this.renderSearchElements() : &lt;div/&gt;
        })()}
      &lt;/div&gt;
    );
  },
  renderSearching(){
    return &lt;div className="row"&gt;
      &lt;div className="col-lg-8 col-lg-offset-2"&gt;
        &lt;div className='text-center'&gt;&lt;i className="fa fa-spinner fa-pulse fa-5x"&gt;&lt;/i&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;;
  },
  renderSearchElements(){
    return (
      &lt;div className="row"&gt;
        &lt;div className="col-lg-8 col-lg-offset-2"&gt;
          &lt;span className='text-center'&gt;Total Results: {this.state.numFound}&lt;/span&gt;
          &lt;table className="table table-stripped"&gt;
            &lt;thead&gt;
            &lt;th&gt;Title&lt;/th&gt;
            &lt;th&gt;Title suggest&lt;/th&gt;
            &lt;th&gt;Author&lt;/th&gt;
            &lt;th&gt;Edition&lt;/th&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
            {this.renderDocs(this.state.docs)}
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  },
  renderDocs(docs){
    return docs.map((doc) =&gt; {
      console.log(doc);
      return &lt;tr key={doc.cover_edition_key}&gt;
        &lt;td&gt;{doc.title}&lt;/td&gt;
        &lt;td&gt;{doc.title_suggest}&lt;/td&gt;
        &lt;td&gt;{(doc.author_name || []).join(', ')}&lt;/td&gt;
        &lt;td&gt;{doc.edition_count}&lt;/td&gt;
      &lt;/tr&gt;
    })
  },

  performSearch(){
    let searchTerm = $(this.refs.searchInput.getDOMNode()).val();
    this.openLibrarySearch(searchTerm);
    this.setState({searchCompleted: false, searching: true});
  },

  parseJSON(response) {   return response.json();  },

  updateState(json){
    this.setState({
      ...json,
      searchCompleted: true,
      searching: false
    });
  },
  openLibrarySearch(searchTerm){
    let openlibraryURI = `https://openlibrary.org/search.json?page=1&amp;q=${searchTerm}}`;
    fetch(openlibraryURI)
      .then(this.parseJSON)
      .then(this.updateState)
      .catch(function (ex) {
        console.log('Parsing failed', ex)
      })
  }
});
module.exports = SearchPage;</a></pre></div><p class="it"><a class="indexterm">"Si te fijas, he </a><a id="id166" class="indexterm">utilizado una función invocada inmediatamente a añadir una <code class="literal">if</code> declaración para mostrar el icono de búsqueda de representación, de la siguiente manera:"</a></p>

<p class="p">"If you notice, I have <a class="indexterm">used an immediately-invoked function to add an <code class="literal">if</code> statement to display the search icon rendering, as follows:"</a></p><div class="informalexample"><pre class="programlisting"><a class="indexterm">          { (() =&gt; {
            if (this.state.searching) {
              return this.renderSearching();
            }
            return this.state.searchCompleted ? this.renderSearchElements() : &lt;div/&gt;
          })()}</a></pre></div><p class="it"><a class="indexterm">"En este caso, hemos utilizado la <code class="literal">()=&gt;{}</code> sintaxis para definir la función y luego invocar inmediatamente <code class="literal">(()=&gt;{}))()</code>, devolviendo el contenido que tenemos que mostrar durante el render."</a></p>

          <p class="p">"Here, we have used the <code class="literal">()=&gt;{}</code> syntax to define the function first and then immediately invoke it <code class="literal">(()=&gt;{}))()</code>, returning the content that we need to display during the render."</p><p class="it"><a class="indexterm">"Gran trabajo, Shawn!" Mike estaba contento con el progreso Shawn había hecho.</a></p>

          <p class="p">"Great work, Shawn!" Mike was happy with the progress Shawn had made.</p><p class="it"><a class="indexterm">"Esto es práctico, cuando queremos añadir interruptores lógicos simples dentro del render en sí, en lugar de definir nuevos métodos", continuó Mike.</a></p>

          <p class="p">"This is handy, when we want to add simple logic switches within the render itself, instead of defining new methods," continued Mike.</p></div></div>
</body></html>